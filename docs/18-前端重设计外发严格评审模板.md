# 前端重设计外发严格评审模板（回收验收版）

> 用途：用于验收“外部 AI 交付的前端重设计包”，确保满足“功能不变、可接入、可运行、可回归”。
>
> 配套文档：`docs/17-前端全站重设计外发约束文档.md`。

---

## 1. 使用流程

1. 先外发 `docs/17`（推荐使用第 7.2 节完整版提示词）。
2. 收回交付后，先做 Gate 否决检查（第 2 节）。
3. Gate 全通过后，再做评分矩阵（第 3 节）。
4. 评分达标后，执行回归核验（第 4 节）。
5. 最后输出通过/不通过结论（第 6 节模板）。

---

## 2. Gate 否决项（任一命中即不通过）

1. 改动 API 合同（路径/字段/语义）。
2. 改动权限规则（角色能力或路由可见范围变化）。
3. 改动核心路由语义（关键 URL 失效或含义变化）。
4. 删除关键入口（注册、登录、邀请码、阅读、互动、作业、讨论、后台）。
5. 无法构建（`npm run build` 失败）。
6. 只交截图/说明，无可接入代码结构。
7. 核心流程中断（任一主流程走不通）。
8. 接口字段映射不一致（请求/响应字段跑偏）。
9. 前台关键展示缺失（未满足 `docs/17` 页面展示合同）。
10. 权限矩阵或重定向行为不一致（与 `docs/17` 第 3 章冲突）。
11. Route Group 接入不兼容（无法接到 `app/(main)`、`app/(independent)`）。
12. 鉴权守卫机制偏离（`proxy.ts` 语义不一致，或 `/reading-legacy` 被错误放开）。

### 2.1 Gate 记录表

| 检查项 | 结果（通过/不通过） | 证据（文件/截图/日志） |
|---|---|---|
| API 合同保持 |  |  |
| 权限规则保持 |  |  |
| 路由语义保持 |  |  |
| 关键入口完整 |  |  |
| 构建通过 |  |  |
| 代码可接入 |  |  |
| 核心流程可走通 |  |  |
| 接口字段一致 |  |  |
| 前台关键展示完整 |  |  |
| 权限矩阵与重定向一致 |  |  |
| Route Group 接入兼容 |  |  |
| proxy 鉴权语义兼容 |  |  |

---

## 3. 评分矩阵（100 分）

> 建议通过线：`>= 85`，且 Gate 全通过。

### 3.1 评分维度

| 维度 | 权重 | 最低要求 | 评分说明 |
|---|---:|---|---|
| 功能等价性 | 30 | >= 26 | 主流程业务结果与原系统一致 |
| 路由与入口可达性 | 15 | >= 12 | 关键页面可达、入口未丢 |
| API/权限兼容性 | 15 | >= 12 | 无合同破坏、无越权呈现 |
| 视觉重设计质量 | 20 | >= 15 | 非换色式重构，有结构升级 |
| 响应式与可访问性 | 10 | >= 7 | 移动/桌面可用、可读可达 |
| 工程可维护性 | 10 | >= 7 | 结构清晰、可持续迭代 |

### 3.2 打分表

| 维度 | 分数 | 证据 | 问题描述 |
|---|---:|---|---|
| 功能等价性（30） |  |  |  |
| 路由与入口可达性（15） |  |  |  |
| API/权限兼容性（15） |  |  |  |
| 视觉重设计质量（20） |  |  |  |
| 响应式与可访问性（10） |  |  |  |
| 工程可维护性（10） |  |  |  |
| **总分（100）** |  |  |  |

---

## 4. 接入与回归核验

### 4.1 构建与基础健康

1. `npm run build` 通过。
2. 核心页面首屏无阻断错误。
3. 控制台无高频严重报错（允许少量非阻断 warning）。

### 4.2 路由与入口核验

1. 公共页：`/` `/course` `/about` `/faq` `/login` `/register`。
2. 过渡页：`/invite` `/profile`。
3. 学习页：`/reading` `/resources` `/tools` `/rules`。
4. 互动页：`/interact` `/interact/[sessionId]` `/homework` `/discussion`。
5. 后台页：`/admin` `/admin/users` `/admin/invites` `/admin/assignments` `/admin/feedbacks` `/admin/moderation` `/admin/settings`。
6. 阅读返回：书籍页左上角返回必须回 `/reading`。
7. 兼容入口：`/read` 必须重定向到 `/reading`。

### 4.3 接口与展示核验

| 核验点 | 必须满足 | 结果（通过/不通过） | 证据 |
|---|---|---|---|
| 认证接口 | `/register` 对接 `/api/settings` 与 `/api/auth/register` |  |  |
| 邀请码升级 | `/invite` 对接 `/api/invite/verify`，失败展示后端错误 |  |  |
| 个人页会话展示 | `/profile` 展示当前会话用户基础信息（用户名/昵称/角色） |  |  |
| 课堂列表 | `/interact` 对接 `/api/interact/sessions`，展示标题/状态/时间 |  |  |
| 课堂实时 | `/interact/[sessionId]` 对接 SSE，处理 `snapshot`/`session_updated`/`settings_updated`/`user_kicked` |  |  |
| 互动动作 | 举手、计时、投票、踢人、禁言字段正确 |  |  |
| 作业模块 | 展示 `lessonId/status/createdAt`，支持附件上传下载 |  |  |
| 反馈提交 | 存在学生反馈入口并调用 `/api/feedbacks` POST（rating/content 至少一项） |  |  |
| 讨论模块 | 展示 `nickname/commentCount/createdAt`，支持发帖评论 |  |  |
| 用户管理 | `/admin/users` 展示并可修改 `role` |  |  |
| 邀请码管理 | `/admin/invites` 展示 `usedCount/maxUses/status` 并可作废 |  |  |
| 治理与日志 | `/admin/moderation` 执行动作并展示日志 |  |  |
| 系统设置 | `/admin/settings` 与接口权限行为一致 |  |  |
| 错误态 | 失败时有可见错误，且不出现“假成功” |  |  |

### 4.4 页面必展示信息抽查

| 页面 | 必展示信息 | 抽查结果（通过/不通过） | 备注 |
|---|---|---|---|
| `/` | 核心学习入口（课程/阅读/互动/工具/资源）可点击可达 |  |  |
| `/register` | 注册开关状态、公告、字段校验提示 |  |  |
| `/invite` | 邀请码输入、失败提示、成功提示 |  |  |
| `/profile` | 用户名/昵称/角色等基础会话信息 |  |  |
| `/reading` | 书籍封面、书名、进入阅读入口 |  |  |
| `/interact` | 课堂标题、状态、创建时间、进入课堂入口 |  |  |
| `/interact/[sessionId]` | 课堂状态、举手队列、发言状态、投票状态 |  |  |
| `/homework` | 作业状态、提交时间、附件入口 |  |  |
| `/discussion` | 帖子作者昵称、评论数、评论时间 |  |  |
| `/admin/users` | 用户角色、注册时间、角色修改控件 |  |  |
| `/admin/invites` | 邀请码、使用情况、状态、作废操作 |  |  |
| `/admin/moderation` | 治理动作入口、治理日志 |  |  |
| `/admin/settings` | 设置展示与保存反馈/无权限态 |  |  |

### 4.5 权限与重定向核验

| 核验点 | 期望行为 | 结果（通过/不通过） | 证据 |
|---|---|---|---|
| visitor 访问学员区 | `/reading`、`/interact`、`/homework` 均 `→login` |  |  |
| registered 访问学员区 | `/reading`、`/tools`、`/discussion` 均 `→invite` |  |  |
| registered 访问 `/invite` | 可访问，不死循环 |  |  |
| registered 访问 `/profile` | 可访问个人页，不重定向到 `/invite` 或 `/home` |  |  |
| student 访问管理页 | `/admin/*` 均 `→home` |  |  |
| teacher 访问管理页 | 可访问 `/admin`、`/admin/assignments`、`/admin/moderation`；不可访问 `/admin/users`、`/admin/invites` |  |  |
| teacher 访问 `/admin/settings` | 路由可达，但接口无权限（不可前端绕过） |  |  |
| admin 访问管理页 | 全部管理页可访问 |  |  |
| blocked 访问受限页 | 除公开页与登录注册外，均拒绝或重定向登录 |  |  |
| 已登录访问登录注册页 | 非 blocked 访问 `/login`、`/register` 均 `→home` |  |  |

### 4.6 技术接入兼容核验

| 核验点 | 期望行为 | 结果（通过/不通过） | 证据 |
|---|---|---|---|
| Route Group 结构 | 可接入 `app/(main)` 与 `app/(independent)` |  |  |
| API 路径结构 | 保持 `app/(main)/api/*` 语义 |  |  |
| 鉴权守卫 | 与 `proxy.ts` 重定向语义一致 |  |  |
| 静态资源保护 | `/reading-legacy` 未被错误放开 |  |  |
| 依赖兼容性 | Next 16 + React 19 + Tailwind 4 兼容 |  |  |

---

## 5. 证据要求（提交复审时必须附）

1. 改动文件清单（按模块分组）。
2. 功能映射差异表（旧入口 -> 新入口）。
3. 接口映射表（页面 -> 接口 -> 字段 -> 错误处理）。
4. 构建结果（命令与结果摘要）。
5. 核心流程回归结果（通过/失败 + 证据）。
6. 已知风险与未完成项。

---

## 6. 结论模板（可直接复制）

### 6.1 通过模板

```text
结论：通过（有条件）
总分：XX/100
Gate：全部通过
主要优点：
1) ...
2) ...
后续风险：
1) ...
2) ...
建议：进入接入阶段并执行回归清单。
```

### 6.2 不通过模板

```text
结论：不通过
原因类型：Gate 失败 / 分数不达标
关键问题：
1) ...
2) ...
3) ...
整改要求：
1) ...
2) ...
复审条件：完成整改并附证据后再提交。
```

---

## 7. 发回外部 AI 的复审任务模板

```text
你的交付未通过评审，请按以下问题整改并重新提交：

【阻断问题】
1) ...
2) ...

【质量问题】
1) ...
2) ...

请重新交付：
1) 修复后的页面与组件代码（可接入结构）
2) 问题对照表（问题 -> 修复点 -> 证据）
3) 构建结果（npm run build）
4) 核心流程回归结果
```
