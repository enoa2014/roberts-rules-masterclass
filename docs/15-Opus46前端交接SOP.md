# Opus 4.6 前端交接 SOP

> 目标：把前端视觉与页面实现稳定交给 Opus 4.6，减少“风格跑偏 / 接口对不上 / 改了后端规则”的返工。  
> 适用：本仓库 `Next.js 16 + TypeScript + Tailwind + NextAuth`。

## 1. 交接原则

1. Opus 只负责前端展示层与交互层，不改后端业务规则。
2. 所有接口以 `docs/04-API合同.md` 为准，禁止私改字段名。
3. 所有路由与角色限制以 `docs/02-信息架构与路由权限清单.md` 为准。
4. 每次只做一个批次，先小步提交，再做下一批。

---

## 2. 交接资料包（最小必给）

每次给 Opus 前，固定附上这 6 份文件：

1. `docs/11-Gemini3Pro前端交接包.md`（作为通用前端边界文档）
2. `docs/12-前端详细设计.md`（视觉与组件规范）
3. `docs/04-API合同.md`（接口合同）
4. `docs/02-信息架构与路由权限清单.md`（路由与权限）
5. `docs/13-前后端联调与API冒烟手册.md`（联调与验收脚本）
6. 当前批次目标说明（你临时写的任务描述）

---

## 3. 推荐协作分工

1. Opus 4.6：页面结构、样式、组件拆分、前端状态管理、接口调用接线。
2. Codex：后端接口、鉴权、数据一致性、回归测试、代码合并和验收。
3. 你：确定视觉方向、优先级、验收标准（通过/不通过）。

---

## 4. 批次化交付策略

建议继续沿用 FE-Bx：

1. FE-B1：`/login` `/register` `/invite`（认证体验）
2. FE-B2：`/` `/course` `/about` `/faq`（品牌与课程介绍）
3. FE-B3：`/rules` `/tools` `/resources` `/reading`（学习主线）
4. FE-B4：`/interact` `/interact/[sessionId]`（互动高频页）
5. FE-B5：`/homework` `/discussion`（课后闭环）
6. FE-B6：`/admin/*`（管理页）

注意：

1. `docs/02` 中部分详情路由是“预留路由”，当前版本未单独上线，不要求强行补齐。
2. 优先先把现有路由做美化和可用，不要扩展新业务。

---

## 5. 发给 Opus 的标准提示词（可直接复制）

```text
你是资深前端工程师。请在当前仓库中完成以下前端批次任务（仅改前端，不改后端规则）：

【项目约束】
1) 技术栈：Next.js 16 App Router + TypeScript + Tailwind
2) API 合同：严格遵循 docs/04-API合同.md
3) 路由权限：严格遵循 docs/02-信息架构与路由权限清单.md
4) 前端边界：遵循 docs/11-Gemini3Pro前端交接包.md
5) 视觉规范：参考 docs/12-前端详细设计.md

【本次任务范围】
- 批次：FE-Bx
- 页面：<填写路由列表>

【强制要求】
1) 不新增后端接口，不修改后端响应结构
2) 所有提交按钮防重复（loading + disabled）
3) 处理 loading / empty / error 三态
4) 移动端优先（375px）并兼容桌面（>=1440px）
5) 保留现有业务能力（不要删功能）

【输出格式】
1) 先给变更文件清单
2) 再给核心代码片段
3) 列出接口对接映射（页面 -> API）
4) 列出手工验证步骤
5) 列出已知风险与未完成项
```

---

## 6. Opus 回传内容验收清单

要求 Opus 每次回传必须包含：

1. 变更文件列表（精确到路径）
2. 每个页面调用了哪些 API（含方法和路径）
3. 手工测试步骤（至少含登录、权限、异常场景）
4. 构建结果（`npm run build`）
5. 若改了实时页，补充 SSE 断线重连说明

---

## 7. Codex 接管后的验收动作

Opus 交付后，Codex 固定执行：

```bash
npm run lint
npm run build
npm run smoke:all
npm run test:e2e:auth
```

如果本次涉及实时互动页，再执行：

```bash
npm run test:e2e:realtime
```

---

## 8. 常见返工点（提前告诉 Opus）

1. 不要把后端字段改名：
 - 计时：`speakerId`、`durationSec`
 - 投票：`pollId`、`selected`（传 optionId）
2. 不要新增不存在的后台路由（如旧的 `/admin/sessions`）。
3. 不要把权限判断只放前端，后端接口 403 需要正确提示。
4. 不要只做“好看”，把可用性和错误态漏掉。

---

## 9. 建议的工作流（你实际操作）

1. 你先确定本轮批次（例如 FE-B2 公共页改版）。
2. 把“标准提示词 + 本轮范围”发给 Opus。
3. Opus 回传代码与说明。
4. 让 Codex 做合并前 code review 与回归测试。
5. 通过后再进入下一批。

这样可以把 UI 提升和稳定性并行推进，不会因为一次大改拖慢整体进度。

