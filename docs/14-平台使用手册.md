# 平台使用手册

> 适用对象：教师、管理员、学员  
> 适用版本：当前仓库主分支（Next.js 16 + SQLite + NextAuth）

## 1. 平台能做什么

本平台用于“议起读”课程的统一学习与互动，覆盖以下场景：

1. 课程学习：规则、工具、资源、阅读站统一入口。
2. 课堂互动：建课、开始课堂、举手、计时、投票、踢出、全员禁言。
3. 课后闭环：作业提交与批阅、讨论区、课堂反馈。
4. 教学治理：用户角色管理、邀请码管理、内容治理日志、反馈导出。

---

## 2. 角色与权限

| 角色 | 典型入口 | 主要权限 |
|------|----------|---------|
| `registered`（已注册） | `/invite` | 登录后可输入邀请码升级资格 |
| `student`（学员） | `/rules` `/reading` `/interact` `/homework` `/discussion` | 学习、互动、提交作业、参与讨论与反馈 |
| `teacher`（教师） | `/admin` `/interact/[sessionId]` | 开课、课堂控制、作业批阅、内容治理、反馈查看 |
| `admin`（管理员） | `/admin` | 教师权限 + 用户/邀请码/系统设置管理 |
| `blocked`（封禁） | `/login` | 无法进入受限区域 |

说明：

1. 首发登录方式是“用户名 + 密码”。
2. 新用户注册后默认是 `registered`，需要邀请码升级为 `student`。

---

## 3. 快速开始（5 分钟）

### 3.1 学员首次使用

1. 打开 `/register` 注册账号。
2. 登录后进入 `/invite` 输入邀请码。
3. 升级成功后，从 `/rules` 或 `/reading` 开始学习。
4. 进入 `/interact` 加入课堂互动。
5. 课后到 `/homework` 提交作业，在 `/discussion` 讨论；课堂反馈由教师统一收集后在后台查看。

### 3.2 教师首次使用

1. 使用教师账号登录。
2. 进入 `/interact` 创建课堂，进入课堂页后点击“开始课堂”。
3. 使用举手队列点名发言、开启计时、发起投票。
4. 课后在 `/admin/assignments` 批阅作业，在 `/admin/moderation` 做内容治理。
5. 在 `/admin/feedbacks` 查看反馈并导出 CSV。

### 3.3 管理员首次使用

1. 使用管理员账号登录进入 `/admin`。
2. 在 `/admin/users` 管理用户角色与封禁状态。
3. 在 `/admin/invites` 生成/作废邀请码。
4. 在 `/admin/settings` 配置注册开关与站点公告。

---

## 4. 学员操作指南

## 4.1 课程学习

1. `规则学习`：`/rules`、`/rules/[slug]`
2. `阅读探究`：`/reading`
3. `工具应用`：`/tools`、`/tools/[slug]`
4. `资料下载`：`/resources`

## 4.2 课堂互动

1. 进入 `/interact` 选择课堂。
2. 课堂已开始后，点击“举手”进入队列。
3. 被教师点名后，页面会显示发言计时状态。
4. 投票开启后按题目选项提交；如重复提交，以最后一次为准。
5. 若课堂结束或被踢出，页面会提示并退出互动。

## 4.3 作业提交

1. 进入 `/homework` 选择作业。
2. 填写作业内容，可上传附件（支持常见文档/图片格式）。
3. 提交后可查看提交状态（`submitted`）与教师评语/评分（如已批阅）。

## 4.4 讨论与反馈

1. 在 `/discussion` 发布帖子、回复评论。
2. 当前版本学员端未提供独立反馈页面，课堂反馈通常由教师统一组织收集。
3. 发帖后默认即时可见，如违规可能被教师/管理员治理。

---

## 5. 教师/管理员操作指南

## 5.1 课堂全流程

1. 创建课堂：`/interact` 新建会话。
2. 开始课堂：进入会话后点击“开始课堂”。
3. 互动控制：
 - 点名发言（选择队列中的学员）
 - 发言计时开始/停止
 - 发起投票/关闭投票
 - 全员禁言开关
 - 踢出违规学员
4. 结束课堂：点击“结束课堂”完成收口。

## 5.2 作业批阅

1. 进入 `/admin/assignments` 查看学员提交列表。
2. 下载附件核对内容。
3. 填写评分与评语并提交批阅。

## 5.3 内容治理

1. 进入 `/admin/moderation` 查看帖子和评论。
2. 对违规内容执行隐藏/删除，对违规用户执行封禁/解封。
3. 在治理日志中追溯操作人、操作时间、原因。

## 5.4 反馈管理

1. 进入 `/admin/feedbacks` 筛选课堂反馈。
2. 需要分析时可导出 CSV。

## 5.5 系统设置（管理员）

1. 进入 `/admin/settings`。
2. 可关闭新用户注册（紧急控流场景）。
3. 可发布全站公告（显示在注册相关页面）。

---

## 6. 常见问题（FAQ）

1. 登录后被跳到 `/invite`：说明账号还是 `registered`，需先输入邀请码升级。
2. 学员无法举手：通常是课堂未开始，教师需先“开始课堂”。
3. 页面提示 403：当前角色权限不足，请联系管理员调整角色。
4. 页面提示 429：登录失败次数过多，稍后再试。
5. 实时状态更新慢：检查网络与 SSE 连接，刷新页面会重新拉取课堂快照。

---

## 7. 本地运行与验收命令（给维护者）

```bash
# 开发
npm run dev

# 构建
npm run build
npm run start

# 数据库
npm run db:push

# 冒烟（含登录限流）
npm run smoke:all

# E2E
npm run test:e2e:auth
npm run test:e2e:realtime

# 备份与恢复
npm run backup:create
npm run backup:restore -- data/backups/<backup-file>.db
```

---

## 8. 运维建议

1. 生产环境开启 HTTPS，并正确透传真实 IP。
2. 每天至少一次数据库备份，并定期演练恢复。
3. `NEXTAUTH_SECRET` 使用随机强密钥，不要写入公开仓库。
4. 课堂期间建议只保留单实例写 SQLite，减少锁冲突风险。

如需部署细节，请配合阅读 `docs/08-部署与运维手册.md`。
