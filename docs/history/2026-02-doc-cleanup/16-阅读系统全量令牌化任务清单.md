# 阅读系统全量令牌化任务清单

## 1. 目标与范围

- 目标：将 `public/reading-legacy/css/` 下阅读系统样式统一到同一套设计令牌体系，消除非 `tokens.css` 的直接色值写法。
- 范围：`public/reading-legacy/css/*.css`（`tokens.css` 除外）。
- 不在本轮范围：交互逻辑改造、模块结构重写、视觉风格重设计。

## 2. 当前基线（硬编码命中数）

> 统计口径：`rg -n "#...|rgba(...|hsla(..."`

| 文件 | 命中数 |
|---|---:|
| `public/reading-legacy/css/modules.css` | 303 |
| `public/reading-legacy/css/story-theme.css` | 175 |
| `public/reading-legacy/css/wave-theme.css` | 118 |
| `public/reading-legacy/css/ove-theme.css` | 92 |
| `public/reading-legacy/css/wonder-theme.css` | 69 |
| `public/reading-legacy/css/bookshelf.css` | 42 |
| `public/reading-legacy/css/lotf-theme.css` | 31 |
| `public/reading-legacy/css/style.css` | 30 |
| `public/reading-legacy/css/home.css` | 26 |
| `public/reading-legacy/css/story-linguistics.css` | 19 |
| `public/reading-legacy/css/story.css` | 9 |
| `public/reading-legacy/css/cards.css` | 4 |
| `public/reading-legacy/css/quiz.css` | 3 |
| `public/reading-legacy/css/map.css` | 2 |
| `public/reading-legacy/css/base.css` | 1 |

## 3. 验收口径（建议）

- 口径 A（严格）：非 `tokens.css` 的所有目标 CSS 中，`#.../rgb.../hsl...` 命中为 0。
- 口径 B（实用）：允许 `#fff/#000` 与 `transparent/currentColor/inherit`，其余必须走 token。
- 建议采用口径 A，避免后续反复返工。

## 4. 分批改造计划

### 批次 1（P0，先清主干）

- 文件：`public/reading-legacy/css/modules.css`、`public/reading-legacy/css/story-theme.css`
- 目标：先把高频重复值抽成令牌，优先替换背景层、边框层、文本层、阴影层。
- 产出：命中数下降至少 60%，不引入页面结构回归。

### 批次 2（P1，主题页大头）

- 文件：`public/reading-legacy/css/wave-theme.css`、`public/reading-legacy/css/ove-theme.css`、`public/reading-legacy/css/wonder-theme.css`
- 目标：建立“主题覆盖令牌”模式，保留主题差异但不直接写色值。
- 产出：三个主题文件可通过“改 token 不改组件样式”完成换肤。

### 批次 3（P1，入口与书架）

- 文件：`public/reading-legacy/css/bookshelf.css`、`public/reading-legacy/css/home.css`、`public/reading-legacy/css/style.css`
- 目标：统一首页、书架、历史样式文件的面板色与阴影层级，收敛到同一套命名。

### 批次 4（P2，长尾）

- 文件：`public/reading-legacy/css/lotf-theme.css`、`public/reading-legacy/css/story-linguistics.css`、`public/reading-legacy/css/story.css`、`public/reading-legacy/css/cards.css`、`public/reading-legacy/css/quiz.css`、`public/reading-legacy/css/map.css`、`public/reading-legacy/css/base.css`
- 目标：清理遗留小文件，处理边角色值和 alpha 过渡。

### 批次 5（P2，命名治理）

- 文件：`public/reading-legacy/css/tokens.css`
- 目标：去重同义令牌，形成“全局令牌 + 主题令牌 + 组件语义令牌”三层结构，并增补注释明确用途。

## 5. 建议的令牌层级

- 全局基础层：`--color-*`、`--alpha-*`、`--shadow-*`、`--radius-*`、`--space-*`。
- 语义层：`--surface-*`、`--text-*`、`--border-*`、`--state-*`。
- 主题覆盖层：`[data-book="..."]` 下仅覆盖语义层，不直接覆盖组件样式。

## 6. 每批验收命令

```bash
# 1) 查看目标文件剩余硬编码
rg -n "#([0-9a-fA-F]{3,8})|rgba?\(|hsla?\(" public/reading-legacy/css/<目标文件>.css

# 2) 全量检查（排除 tokens.css）
rg -n "#([0-9a-fA-F]{3,8})|rgba?\(|hsla?\(" public/reading-legacy/css/*.css -g '!public/reading-legacy/css/tokens.css'

# 3) 构建回归
npm run build
```

## 7. 给前端代理的执行约束（建议原样下发）

- 只做令牌化替换，不改 HTML 结构，不改 JS 逻辑。
- 每次只提交一个批次，便于回滚与复核。
- 每次提交必须包含：变更文件清单、替换前后命中数对比、`npm run build` 结果、主题差异保留说明（哪些是主题 token，不是硬编码）。
