# 实施路线与里程碑

> 说明：本文件承接原 `implementation_plan.md` 的可执行部分，作为 `docs/` 体系内唯一实施路线文档。

## 快速导航

- 文档总索引：`docs/00-文档索引.md`
- 项目总说明：`README.md`
- 详细设计与任务拆解：`docs/10-详细设计与任务拆解.md`
- Gemini 前端交接：`docs/11-Gemini3Pro前端交接包.md`

## 1. 目标与边界

- 首发目标：完成统一登录、邀请码资格、课程学习、课堂互动、课后闭环、后台治理
- 首发登录：用户名+密码
- 短信登录：MVP+1
- 阅读站策略：先整体嵌入，再重构
- 并发目标：单课堂约 30 人，优先数据一致性

---

## 2. 阶段计划

## Phase 1：项目骨架与基础设施

交付内容：

1. Next.js 15 项目初始化
2. Drizzle + SQLite 建库迁移
3. NextAuth 凭证登录（用户名密码）
4. `middleware` 权限框架
5. Dockerfile + docker-compose + `/api/health`

里程碑验收：

- 本地与 Docker 启动成功
- 公开页可访问
- 未登录访问受限路由被拦截

## Phase 2：资格体系与核心权限

交付内容：

1. 注册/登录流程
2. 邀请码验证页与接口
3. 邀请码事务核销（防并发超发）
4. 角色与路由权限联动

里程碑验收：

- `registered -> student` 流程跑通
- `/invite` 无重定向死循环

## Phase 3：课程内容与阅读站嵌入

交付内容：

1. 公开内容页：首页、课程总览、关于与报名、FAQ
2. 受限内容页：规则、工具、资源、作业入口
3. 阅读站整体嵌入到 `/reading`

里程碑验收：

- `student` 可访问全部受限学习内容
- 未登录/未资格用户被正确拦截

## Phase 4：课堂互动

交付内容：

1. 课堂会话管理（创建、开始、结束）
2. 举手队列与发言计时
3. 投票（单选/多选/匿名）
4. SSE 广播与状态快照恢复

里程碑验收：

- 课堂完整流程可跑通
- 30 人课堂下关键互动稳定

## Phase 5：课后闭环与治理

交付内容：

1. 作业提交与批阅
2. 反馈收集
3. 留言讨论（发布即显示）
4. 事后治理（隐藏/删除/封禁 + 日志）

里程碑验收：

- 学员闭环流程可用
- 教师端治理能力可用且可追溯

## Phase 6：上线与运维

交付内容：

1. 生产部署（Docker + Nginx + HTTPS）
2. 备份与恢复脚本
3. 监控与巡检清单
4. 回滚预案

里程碑验收：

- 一次完整上线演练通过
- 恢复演练通过

---

## 3. 任务优先级

| 优先级 | 任务 |
|--------|------|
| P0 | 认证、邀请码事务一致性、路由权限 |
| P0 | 阅读站嵌入可用、课程核心内容上线 |
| P0 | Docker 部署与数据持久化 |
| P1 | 课堂互动（举手/计时/投票） |
| P1 | 作业、反馈、留言治理 |
| P2 | 阅读站逐步重构 |
| P2 | 短信登录与账号绑定 |

---

## 4. 风险与应对

| 风险 | 影响 | 应对 |
|------|------|------|
| 邀请码并发核销超发 | 资格失真 | 事务 + 条件更新 + 唯一约束 |
| 阅读站样式脚本冲突 | 页面异常 | 首发 iframe 隔离 |
| SSE 在 CDN 断连 | 互动体验差 | 对流接口禁缓存并放宽超时 |
| SQLite 写压力上升 | 锁冲突 | 保持单实例写，后续迁移 MySQL/PostgreSQL |

---

## 5. 文档映射

- 范围与验收：`docs/01-MVP范围与验收标准.md`
- 权限与路由：`docs/02-信息架构与路由权限清单.md`
- 数据与迁移：`docs/03-数据库设计与迁移策略.md`
- API：`docs/04-API合同.md`
- 互动状态机：`docs/05-课堂互动状态机.md`
- 阅读站路线：`docs/06-阅读站嵌入与重构路线图.md`
- 测试计划：`docs/07-测试计划与用例.md`
- 部署运维：`docs/08-部署与运维手册.md`
- 详细设计与任务拆解：`docs/10-详细设计与任务拆解.md`
- Gemini 前端交接：`docs/11-Gemini3Pro前端交接包.md`
