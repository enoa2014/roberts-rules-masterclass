# 课程整合与课堂互动系统总需求（统一文档 V6）

## 1. 项目目标

搭建一套面向课程学员的低成本课程学习与课堂互动系统，覆盖：

1. 课程内容整合学习（议起读完整课程体系）
2. 课堂实时互动（举手、计时、投票、选择）
3. 课后学习闭环（反馈、作业、复盘）
4. 资格鉴定与权限控制（仅合格学员可用受限功能）

**本阶段不做的事项**：不做视频直播、不做支付收费、不做微信小程序。

---

## 2. 需求范围

## 2.1 课程整合需求

1. 课程内容覆盖范围

- 第一阶段：议事规则专项（2次）
- 第二阶段：四大探究方向（8次）
- 横向能力：15 个核心思考工具
- 增强模块：议事规则 + AI 工具、实习支持

1. 内容组织方式

- 统一入口，不做教师/家长双入口分流
- 支持“课次主线 + 能力专题（规则/文本/工具/案例）”
- 支持课前预习、课中实践、课后复盘连续路径

1. 内容模块

- 课程总览与课程地图
- 议事规则模块（十二条、动议流程、案例）
- 阅读探究模块（四大方向与文本入口）
- 思考工具库（15 工具）
- 作业与复盘
- 资源中心（议程模板、主持脚本、话术卡）
- FAQ（常见课堂/家庭协商问题）

## 2.2 课堂互动需求

1. 实时互动

- 举手发言队列
- 发言计时器（教师端控制）
- 投票（单选/多选/可选匿名）
- 选择题互动

1. 学员资格与账号

- 仅资格通过学员可使用互动与作业功能
- 需要登录后才能访问受限内容
- 资格发放方式：**邀请码**（教师生成邀请码，学员输入后立即获得学员资格）
- 资格状态流转：`registered`（已注册）→ `student`（邀请码通过）→ `blocked`（封禁）
- 管理员可手动调整任意用户角色

1. 阅读探究系统整合

- 现有阅读站必须接入统一登录与统一权限控制
- 允许迁移现有阅读站代码到本项目中，统一账号体系后再开放访问

1. 内容访问分级

- **公开内容**（无需登录）：首页、课程总览（结构介绍）、FAQ、关于与报名
- **学员专属**（需登录 + 学员资格）：完整课程内容、课程PPT、阅读探究资源、工具库详情、作业提交、课堂互动、资源下载
- **管理权限**（教师/管理员）：学员管理、课堂控制、作业批阅、数据导出

1. 用户角色定义

- `visitor`：未登录用户，仅可访问公开内容
- `registered`：已登录但未输入邀请码，可看公开内容 + 个人设置
- `student`：邀请码验证通过，可访问全部课程内容与互动功能
- `teacher`：教师/助教，可控制课堂、批阅作业
- `admin`：超级管理员，拥有全部权限

1. 课后闭环

- 课堂反馈收集
- 课后作业提交（文本/附件）
- 留言/讨论
- 教师查看与标记状态

## 2.3 运营与实施要求

1. 优先免费或低成本方案，支持长期运行
2. 终端形态为**响应式 Web 站**（微信内可直接打开链接使用）
3. 支持 AI 协同持续开发
4. 先做 MVP，再迭代增强
5. 留言/讨论区默认不做事前审核，采用事后治理（教师删除/封禁）

---

## 3. 成功标准（首月）

1. 课程内容覆盖率 >= 95%
2. 关键学习任务完成率 >= 60%
3. 学员 3 次点击内到达可执行任务页
4. 课堂互动流程可稳定跑通（创建课堂 -> 举手计时 -> 投票 -> 收集反馈）
5. 学员注册到首次进入课程内容 < 3 分钟
6. 单课堂规模 30 人以内稳定运行，优先保证数据一致性

---

## 4. MVP 范围（第一阶段）

1. 账号与鉴权

- 首发登录方式：**用户名 + 密码**（支持注册与登录）
- 首发不强依赖短信登录，短信验证码登录作为后续增强（MVP+1）
- 用户名密码方式不强制绑定手机号验证
- 两种登录方式账号默认独立，后续可选增加“账号绑定”能力
- 邀请码验证：登录后输入教师提供的邀请码，即时获得 `student` 资格
- 防刷策略（启用短信登录时）：短信每号每日限 5 次、60 秒间隔、需图形验证码

1. 课堂互动

- 举手队列
- 发言计时
- 单选/多选投票

1. 课程内容最小集

- 课程总览（2+8+15 结构）—— 公开
- 议事规则两次课核心内容 —— 受限
- 四大探究方向入口页 + 阅读探究内容（迁移现有阅读站并接入统一登录）—— 受限
- 工具库目录页 —— 受限
- 资源下载页 —— 受限

1. 课后模块

- 反馈问卷
- 作业提交与查看
- 留言/讨论（默认不做事前审核，支持教师事后删除与封禁）

1. 管理后台

- 学员列表与角色管理
- 邀请码生成与管理（支持有效期、使用次数上限）
- 课堂控制
- 作业/反馈查看导出

---

## 5. 信息架构（统一版）

1. 一级模块（含访问级别）

- 首页 —— 🌐 公开
- 课程总览 —— 🌐 公开
- 关于与报名 —— 🌐 公开
- 议事规则专项 —— 🔒 学员专属
- 阅读探究 —— 🔒 学员专属
- 工具库 —— 🔒 学员专属
- 课堂互动 —— 🔒 学员专属
- 作业与复盘 —— 🔒 学员专属
- 资源中心 —— 🔒 学员专属
- FAQ —— 🌐 公开
- 管理后台 —— 🛡️ 教师/管理员

1. 关键路径

- 学员路径：登录 -> 输入邀请码 -> 课程学习 -> 课堂互动 -> 反馈/作业 -> 复盘
- 教师路径：创建课堂 -> 管控互动 -> 查看反馈与作业 -> 复盘优化
- 未注册访客路径：首页/课程总览/FAQ -> 登录入口

---

## 6. 技术方向（基于审核后确认）

1. 终端形态

- **响应式 Web 站**（一套代码，适配 PC/平板/手机，微信内可直接打开链接）
- 不做微信小程序

1. 技术栈

- 框架：**Next.js 15**（App Router，前后端一体）
- 运行时：Node.js v22（已安装）
- 数据库：**SQLite**（via better-sqlite3，零运维，单文件，MVP 足够）
- ORM：**Drizzle ORM**（轻量、类型安全）
- 认证：**NextAuth.js v5**（Credentials Provider）
- 短信：**阿里云短信 SDK**（~0.04元/条）
- 样式：Vanilla CSS + CSS Modules

1. 部署建议

- 全栈应用部署在 **阿里云 ECS**（前后端同一服务，避免跨域）
- 域名与证书：现有备案域名 + HTTPS
- 可选：腾讯云 EdgeOne / 阿里云 ESA 作为 **CDN 加速层**放在前面

1. 认证方案

- 首发：用户名 + 密码（bcrypt 加密存储）
- 增强：手机号 + 短信验证码（签名与模板通过后再上线）
- Session 管理：JWT + HttpOnly Cookie
- 用户名密码方式不强制手机号验证
- 默认不自动合并两种登录方式账号（后续可选人工/自助绑定）

---

## 7. 现有资源清单

## 7.1 基础设施

1. 阿里云 99 元特惠个人云服务器
2. 腾讯云 EdgeOne 免费版
3. 阿里云 ESA
4. 已注册并备案域名
5. 免费 DNS

## 7.2 AI 与生产工具

1. Codex（主力开发）
2. Gemini Pro 3
3. Opus 4.6
4. Gemini Pro 订阅
5. ChatGPT Plus 订阅
6. Lovart 会员（nanobanana pro 出图）
7. NotebookLM（内容解析、PPT、信息图、闪卡）

## 7.3 内容与代码资产

1. 课程素材与课件：`res/`
2. 现有课程站点：`/home/ctyun/work/tttt`
3. 现有阅读站：`/home/ctyun/work/read/reading-garden`

---

## 8. 风险与注意事项

1. 域名 HTTPS 与备案需确认就绪
2. 实时互动优先稳定性，课堂规模以 30 人内为目标，MVP 使用 SSE 或轮询
3. 免费资源可启动 MVP，但需监控并发、带宽、存储增长
4. 若计划上线短信登录，需提前开通短信服务（阿里云短信签名 + 模板审核需 1-2 工作日）；首发可仅上用户名密码登录
5. 短信验证码有成本（~0.04元/条），需做防刷（图形验证码 + 频率限制）
6. 数据备份策略：至少每日自动备份 SQLite 数据库文件
7. 阅读站迁移后必须统一接入当前鉴权体系，不保留无鉴权访问入口
8. 阅读站迁移策略采用“先整体嵌入再重构”，先保障统一登录可用，再逐步组件化与后端化
9. 现有静态 HTML 代码将移至 `legacy/` 保留参考，Next.js 页面重新编写但沿用相同视觉设计
10. 留言区不做事前审核，需提供事后治理能力（删除、封禁、操作日志）

---

## 9. 执行顺序（下一步）

1. ✅ 冻结 MVP 清单与技术方案（已完成）
2. 初始化 Next.js 项目，搭建数据库 schema 与认证系统
3. 实现登录/注册/邀请码全流程
4. 迁移课程内容页面（公开页 + 受限页 + 访问控制中间件）
5. 阅读站先整体嵌入并接入统一登录与权限控制
6. 在嵌入可用基础上逐步重构阅读站页面与数据结构
7. 搭建管理后台（学员管理 + 邀请码管理 + 留言事后治理）
8. 实现课堂互动功能（举手/计时/投票）
9. 完成一次全链路联调（注册 -> 邀请码 -> 学习 -> 互动 -> 作业）

---

## 10. 本轮确认决策（2026-02-14）

1. 短信登录可以先不上，首发以用户名密码登录为主
2. 阅读站采用“先整体嵌入，再重构”的实施策略
3. 留言/讨论区不做事前审核，采用事后治理
